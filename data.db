import pandas as pd
import sqlite3

# Connect to SQLite database (it will create the file if it doesn't exist)
conn = sqlite3.connect('identifiers.db')
cursor = conn.cursor()

# Create the identifiers table if it doesn't already exist
cursor.execute('''
CREATE TABLE IF NOT EXISTS identifiers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    identifier TEXT UNIQUE,
    taskid TEXT
)
''')
conn.commit()

def add_identifier(identifier, taskid):
    """Add a new identifier to the database."""
    try:
        cursor.execute('INSERT INTO identifiers (identifier, taskid) VALUES (?, ?)', (identifier, taskid))
        conn.commit()
        return {"isDuplicate": False, "message": "Identifier added successfully."}
    except sqlite3.IntegrityError:
        return {"isDuplicate": True, "message": "Duplicate identifier."}

def process_csv_file(file_path):
    """Process the CSV file and add identifiers to the database."""
    # Read the CSV file
    df = pd.read_csv(file_path)

    # Iterate through the rows in the DataFrame
    for index, row in df.iterrows():
        identifier = row['identifier']  # Identifier column from CSV
        taskid = row['taskid']  # Task ID column from CSV

        # Add the identifier to the database
        result = add_identifier(identifier, taskid)
        print(f"Row {index}: Identifier '{identifier}' - {result['message']}")

# Run the script
if __name__ == '__main__':
    # Path to your CSV file
    csv_file_path = 'identifiers.csv'  # Replace with your file name
    process_csv_file(csv_file_path)

    # Display all records in the database
    cursor.execute('SELECT * FROM identifiers')
    all_records = cursor.fetchall()
    print("\nDatabase Contents:")
    for record in all_records:
        print(record)


#-----------------------------------------------------------------------------------


import sqlite3
from datetime import datetime

# Initialize SQLite database
conn = sqlite3.connect('identifiers.db')
cursor = conn.cursor()

# Create the table if not exists
cursor.execute('''
CREATE TABLE IF NOT EXISTS identifiers (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date TEXT,
    identifier TEXT UNIQUE
)
''')
conn.commit()

def add_identifier(identifier):
    """Add a new identifier to the database."""
    try:
        date = datetime.now().strftime('%Y-%m-%d')
        cursor.execute('INSERT INTO identifiers (date, identifier) VALUES (?, ?)', (date, identifier))
        conn.commit()
        return {"isDuplicate": False, "message": "Identifier added successfully."}
    except sqlite3.IntegrityError:
        return {"isDuplicate": True, "message": "Duplicate identifier."}

def check_identifier(identifier):
    """Check if an identifier exists in the database."""
    cursor.execute('SELECT * FROM identifiers WHERE identifier = ?', (identifier,))
    return cursor.fetchone() is not None
